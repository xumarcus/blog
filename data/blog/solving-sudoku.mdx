---
title: Solving Sudoku
date: '2021-09-08'
tags: ['Algorithms']
draft: false
summary: Implementing a minimal-guess Sudoku solver
images: []
layout: PostLayout
---

Sudoku is a well-known NP-complete problem. The rules are simple:

> Fill a 9 × 9 grid with digits so that each column, each row, and each of the nine 3×3 subgrids that compose the grid (also called "boxes", "blocks", or "regions") contain all of the digits from 1 to 9.

With insufficient clues, multiple solutions can exist. As an extreme example, this Sudoku has no clues and has 6,670,903,752,021,072,936,960 solutions.

> Click on the cells to add or remove clues.

<Sudoku initCanBacktrack initShowHints />

Most of the time though, the puzzle setter should provide a partially completed grid that has a unique solution, that you can usually find with deduction alone, instead of guessing every possible permutation and check if it is a solution. This puzzle is one such example.

> Turn on **Show Hints** if you don't wish to attempt.

<Sudoku
  digits={
    // https://github.com/xumarcus/sudoku/blob/8392698798747b6e24918be1e48cef1f04250239/tests/lib.rs#L158-L187
    // prettier-ignore
    [
      0, 0, 0, 7, 0, 0, 0, 0, 0,
      1, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 4, 3, 0, 2, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 6,
      0, 0, 0, 5, 0, 9, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 4, 1, 8,
      0, 0, 0, 0, 8, 1, 0, 0, 0,
      0, 0, 2, 0, 0, 0, 0, 5, 0,
      0, 4, 0, 0, 0, 0, 3, 0, 0,
    ]
  }
/>

More formally, Sudoku can be viewed as a constraint satisfaction problem (CSP), where one needs to find a state that satisfies a number of constraints. Other examples of CSPs are 2-SAT, 3-SAT, 8-Queens and 15-Puzzles. This is an example of a 2-SAT,

```python
  SAT = lambda x1, x2, x3, x4: (x1 or x2) and (not x1 or x3) and (x2 or not x4)
```

in which you need to find an assignment for which `SAT` evaluates to `true` (such as `SAT(1, 0, 1, 0)`). There are known linear time algorithms for 2-SAT. Consider an (implication) graph where the nodes are `x1 = 0, x1 = 1, x2 = 0, x2 = 1, x3 = 0, x3 = 1, x4 = 0, x4 = 1` and the (directed) edges represent implications. For instance, since `x1 = 1 => x3 = 1` in the above example, you can draw an edge from `x1 = 1` to `x3 = 1`. Then if mutually exclusive outcomes (`x1 = 0` and `x1 = 1`) are in the same strongly connected component of the graph, that formula is not satisfiable.

In a similar fashion, Sudoku clues can imply what values which cell has to be. Consider this puzzle,

<Sudoku
  digits={
    // prettier-ignore
    [
      0, 0, 0, 0, 0, 0, 0, 0, 0,
      1, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 4, 3, 0, 2, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 6,
      0, 0, 0, 5, 0, 9, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 4, 1, 8,
      0, 0, 0, 0, 8, 1, 0, 0, 0,
      0, 0, 2, 0, 0, 0, 0, 5, 0,
      0, 4, 0, 0, 0, 0, 3, 0, 0,
    ]
  }
  initShowHints
/>

The (greyed out) `5` in _g4_ can be deduced using local constraints alone, by observing that no other `5` can reside in the _5_-th row and the _h_-column, yet the block that _g4_ belongs to must contain exactly one `5`.

Before we continue, let us revisit **P** and **NP**:

- If you can _find_ a solution in polynomial time, the problem is said to be in **P**.
- If you can _verify_ a solution in polynomial time, the problem is said to be in **NP**.
- Intuitive speaking, you can _find_ a solution to an **NP** problem in _non-deterministic_ polynomial time by _verifying_ all solutions in polynomial time using a _infinitely_ parallel computer.

Unfortunately, while 2-SAT is in **P**, Sudoku is **NP** but not (known to be) **P**. Consider this puzzle from [Arto Inkala](https://www.linkedin.com/in/arto-inkala-9651485a), which is one of the _hardest_ known Sudoku puzzles. No cells can be deduced using local constraints alone.

> Turn on **Backtracking** to solve the puzzle.

<Sudoku
  digits={
    // https://github.com/xumarcus/sudoku/blob/8392698798747b6e24918be1e48cef1f04250239/tests/lib.rs#L189-L218
    // prettier-ignore
    [
      8, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 3, 6, 0, 0, 0, 0, 0,
      0, 7, 0, 0, 9, 0, 2, 0, 0,
      0, 5, 0, 0, 0, 7, 0, 0, 0,
      0, 0, 0, 0, 4, 5, 7, 0, 0,
      0, 0, 0, 1, 0, 0, 0, 3, 0,
      0, 0, 1, 0, 0, 0, 0, 6, 8,
      0, 0, 8, 5, 0, 0, 0, 1, 0,
      0, 9, 0, 0, 0, 0, 4, 0, 0,
    ]
  }
  initShowHints
/>
